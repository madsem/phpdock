services:
  web:
    build:
      context: ./docker/nginx
      dockerfile: Dockerfile
    ports:
      - ${WEB_PORT:-80}:80
    volumes:
      - php-sock:/socket
      - ./:/var/www/html
    networks:
      - phpdock
    depends_on:
      - app

  app:
    build:
      context: ./docker/app
      dockerfile: Dockerfile
      args:
        - MY_PHP_VERSION=${PHP_VERSION}
    volumes:
      - php-sock:/socket
      - ./:/var/www/html
    networks:
      - phpdock

  singlestoredb:
    platform: linux/amd64
    image: ghcr.io/singlestore-labs/singlestoredb-dev:latest
    volumes:
      - "singlestore_data:/data"
    restart: always
    environment:
      ROOT_PASSWORD: ${DB_PASS:-secret}
    ports:
      - 3306:3306
      - 8080:8080
      - 9000:9000
    networks:
      - phpdock

  mail:
    image: mailhog/mailhog
    ports:
      - 8025:8025
    networks:
      - phpdock

  redis:
    image: redis:${REDIS_VERSION}
    command: ["redis-server", "--appendonly", "yes"]
    volumes:
      - redisdata:/data
    networks:
      - phpdock

volumes:
  php-sock:
  singlestore_data:
  redisdata:

networks:
  phpdock:
    driver: bridge
